<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Shards of the Outlands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Aclonica">
    <link rel="stylesheet" type="text/css" href="lib/noty.3.1.4.min.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="src/main.css">
    <link rel="stylesheet" type="text/css" href="src/shards.css">
  </head>
  <body>
    <div id="ui-main" class="w-100" align="center">
      <!--MENU---------------------------------------------->
      <h1 class="mx-1">Shards of the Outlands</h1>
      <div class="d-flex justify-content-end align-items-center" style="z-index:100">
        <div class="mx-1 p-1 border">{{net}}</div>
        <div class="p-1 border">{{address.slice(0,5)+'...'+address.slice(-5)}}</div>
        <div class="d-flex flex-row-reverse">
          <div class="m-2">
            <a class="btn btn-info btn-sm" data-toggle="collapse" href="#menu-list" role="button">
              <img src="media/md-menu.svg" height="20" width="20">
            </a>
          </div>
          <div class="card collapse" id="menu-list" style="position: absolute;width:200px;right:50px;z-index:100">
            <div class="card card-body p-1">
              <a type="button" class="btn btn-block btn-info" href="index.html">Home</a>
              <button type="button" class="btn btn-block btn-info" @click="show='daily'" data-toggle="collapse" href="#menu-list">Free Treasure</button>
              <button type="button" class="btn btn-block btn-info" @click="show='inventory'" data-toggle="collapse" href="#menu-list">Inventory</button>
              <button type="button" class="btn btn-block btn-info" @click="show='explorers'" data-toggle="collapse" href="#menu-list">Explorers</button>
              <button type="button" class="btn btn-block btn-info" @click="show='admin'" data-toggle="collapse" href="#menu-list" v-if="isAdmin.length>0">Admin</button>
            </div>
          </div>
        </div>
      </div>
      <!--END MENU---------------------------------------------->
      <about v-if="show=='about'"></about>
      <!--ADMIN---------------------------------------------->
      <div class="m-1" align="left" v-if="show=='admin'">
        <ui-eth-admin-multi></ui-eth-admin-multi>
      </div>
      <!--END ADMIN---------------------------------------------->
      <ui-daily v-if="show=='daily'" :now="now"></ui-daily>
      <ui-staking v-if="show=='staking'" :now="now" :tokens="tokens" :allowance="allowance"></ui-staking>
      <ui-explorers v-if="show=='explorers'" :now="now" :explorers="explorers" :tokens="tokens"></ui-explorers>
      <!--INVENTRORY/STORE---------------------------------------------->
      <div class="m-1" align="center" v-if="show=='inventory'">
        <div class="container">
          <h3 align="left">Store</h3>
          <div align="right">DMD {{tokens.dmd.val.toFixed(2)}}</div>
          <div class="row align-items-center">
            <div class="col">What</div>
            <div class="col">Cost</div>
            <div class="col">Item</div>
            <div class="col"></div>
          </div>
          <div class="row border align-items-center py-1" v-for="(sku,id) in store">
            <div class="col">{{sku.text}}</div>
            <div class="col">{{sku.toPay}}</div>
            <div class="col">{{sku.toBuy}}</div>
            <div class="col" align="right">
              <button class="btn btn-outline-success" type="button" @click="buySKU(id,sku)">Buy</button>
            </div>
          </div>
        </div>
        <div class="mt-2 container" align="left">
          <h3>Inventory</h3>
          <div class="d-flex flex-wrap">
            <div class="p-1 border w-50" v-for="(t,id) in tokens">{{t.name}}: {{t.val%1>0 ? t.val.toFixed(2) : t.val.toFixed(0)}}</div>
          </div>
        </div>
      </div>
      <!--END INVENTRORY/STORE---------------------------------------------->
      <!--REGIONS / SHARDS---------------------------------------------->
      <div class="m-1" align="left" v-if="show==''">
        <div class="m-1 p-1 border" v-for="(Realm,i) in realms">
          <h4>{{Realm.name}}</h4>
          <div class="p-1 region" v-for="S in shards" v-if="shards && S._realm == i">
            <div class="d-flex align-items-end">
              <h5 class="m-0 p-0">{{S.seed}}</h5>
              <div class="mx-2">{{S.alignment}}, {{S.safety}}, {{S.climate}}</div>
            </div>
            <div>{{S.anchor.text}} [{{S.anchor.rarity}}]</div>
          </div>
        </div>
      </div>
      <!--END REGIONS---------------------------------------------->
      <!--FOOTER---------------------------------------------->
      <!--END FOOTER---------------------------------------------->
    </div>
    <!--EXPLORERS---------------------------------------------->
    <template id="ui-explorers">
      <div class="m-1" align="left">
        <div class="container">
          <h3>Explorers</h3>
          <div class="border my-1 py-1" v-for="(ex, id) in explorers">
            <div class="row align-items-center">
              <div class="col-sm">
                ID: {{ex.seed}} <span v-if="ex._cool > now">({{cool(ex._cool)}})</span>
              </div>
              <div class="col-sm link" @click="act[id] = 'Explore',exid = id">{{ex.shard.realmName}} - {{ex.shard.seed}}</div>
              <div class="col-sm-4">
                <div class="input-group">
                  <select class="custom-select" v-model="act[id]">
                    <option v-if="!ex.shard" value="initLoc">Initialize Location</option>
                    <option v-for="(act,i) in actOpts" :value="act">{{act}}</option>
                  </select>
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" @click="exid = id">Act</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="m-1" v-if="search[id]" align="center">
              <button class="btn btn-success" type="button" v-if="search[id].cool > now" disabled>Search: {{search[id].what}} ({{searchTime(search[id].cool)}})</button>
              <div class="mx-2 d-flex justify-content-between" v-if="search[id].cool < now">
                <div>An {{search[id].res.skills.text.join('/')}} is willing to work for you.</div>
                <button class="btn btn-success" type="button" @click="hireAdventurer(id)">Hire Them ({{search[id].res.cost}} DMD)</button>
              </div>
            </div>
            <!--EXPLORER ACTIONS---------------------------------------------->
            <div class="my-1 mx-3" v-if="exid == id && act[id] != ''">
              <!--EXPLORER MOVE---------------------------------------------->
              <div class="input-group" v-if="act[id] == 'initLoc' || act[id] == 'Move'">
                <div class="input-group-prepend">
                  <span class="input-group-text">Shard</span>
                </div>
                <select class="custom-select" v-model="moveTo">
                  <option v-for="s in shards" :value="s.id" v-if="s.id != ex._shard">{{s.realmName}} - {{s.seed}}</option>
                </select>
                <div class="input-group-append">
                  <span class="input-group-text" v-if="moveTo != '' && moveTime>0">{{moveTime}} hours</span>
                  <button class="btn btn-outline-secondary" type="button" @click="move()" :disabled="ex._cool > now">Move</button>
                </div>
              </div>
              <!--EXPLORE---------------------------------------------->
              <div v-if="act[id] == 'Explore' && ex._shard">
                <div class="d-flex justify-content-between">
                  <div>
                    <div>{{ex.shard.realmName}} - {{ex.shard.seed}}</div>
                    <div>{{ex.shard.anchor.text}} [{{ex.shard.anchor.rarity}}] {{ex.shard.anchor.risk[1]}} Risk</div>
                  </div>
                  <button class="btn btn-outline-success" type="button" @click="explore()" :disabled="ex._cool > now">Explore</button>
                </div>
              </div>
              <!--END EXPLORE---------------------------------------------->
              <!--EXPLORER COOLDOWN---------------------------------------------->
              <div class="input-group" v-if="act[id] == 'Reduce Cooldown'">
                <div class="input-group-prepend">
                  <span class="input-group-text">Reduce by</span>
                </div>
                <select class="custom-select" v-model="optsReduceCool.id">
                  <option v-for="c in cooldown" :value="c[0]">{{c[1].name}} [{{c[1].val}}]</option>
                </select>
                <div class="input-group-prepend">
                  <span class="input-group-text">#</span>
                </div>
                <input type="number" class="form-control" v-model="optsReduceCool.qty">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button" @click="reduceCool()">Reduce</button>
                </div>
              </div>
              <!--END COOLDOWN---------------------------------------------->
              <!--EXPLORER HIRE ADVENTURERS---------------------------------------------->
              <div v-if="act[id] == 'Hire Adventurers'">
                <div class="d-flex justify-content-between">
                  <div>
                    <div>{{ex.shard}}</div>
                    <div>{{ex._shard.anchor.text}} [{{ex._shard.anchor.rarity}}] {{ex._shard.anchor.risk[1]}} Risk</div>
                    <div>To hire them, you first have to find them. The time it takes depends upon the anchor of the shard.</div>
                  </div>
                  <button class="btn btn-outline-success" type="button" @click="searchForAdventurers()" :disabled="ex._cool > now">Search</button>
                </div>
              </div>
              <!--END HIRE ADVENTURERS---------------------------------------------->
            </div>
            <!--END EXPLORER ACTIONS---------------------------------------------->
          </div>
        </div>
      </div>
    </template>
    <!--END EXPLORERS---------------------------------------------->
    <!--DAILY TREASURE---------------------------------------------->
    <template id="ui-daily">
      <div class="m-1" align="left">
        <div class="container" v-if="hasFree">
          <h3>Free Treasure</h3>
          <div class="border p-2" align="center" v-for="(t, id) in free" v-if="t.until > now && !hasClaimed.includes(id)">
            <h5>{{t.title}}</h5>
            <div>{{t.text}}</div>
            <div v-for="T in formatTokenText(t.T)">{{T}}</div>
            <button class="btn btn-outline-success btn-block" type="button" @click="claimFree(id)">Claim</button>
          </div>
        </div>
        <div class="container">
          <h3>Daily Treasure</h3>
          <div class="row">
            <div class="col-sm" v-for="i in 3">
              <button class="btn btn-outline-success btn-block" type="button" @click="claim(i-1)">
                <span v-if="timeRemaining[i-1] == 0">Claim {{period[i-1]}}</span>
                <span v-else>Ready in {{formatTime[i-1]}}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </template>
    <!--END DAILY TREASURE---------------------------------------------->
  </body>
  <script src="lib/d3.min.js"></script>
  <script src="lib/vue.2.5.16.min.js"></script>
  <script src="lib/noty.3.1.4.min.js"></script>
  <script src="lib/popper.1.12.3.min.js"></script>
  <script src="lib/jquery-3.3.1.min.js"></script>
  <script src="lib/bootstrap.min.js"></script>
  <script type="module" src="src/main.js"></script>
</html>
