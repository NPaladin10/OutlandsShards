<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Guilds of the Outlands</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Aclonica">
    <link rel="stylesheet" type="text/css" href="lib/noty.3.1.4.min.css">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="src/main.css">
    <link rel="stylesheet" type="text/css" href="src/shards/main.css">
  </head>
  <body>
    <div id="ui-main" class="w-100" align="center">
      <!--MENU---------------------------------------------->
      <div class="d-flex justify-content-between m-1" style="z-index:100">
        <div>
          <h1>Shards of the Outlands</h1>
        </div>
        <div class="d-flex align-items-center">
          <div class="mx-1 p-1 border">{{net}}</div>
          <div class="p-1 border">{{address.slice(0,5)+'...'+address.slice(-5)}}</div>
          <div class="d-flex flex-row-reverse">
            <div class="m-2">
              <a class="btn btn-info btn-sm" data-toggle="collapse" href="#menu-list" role="button">
                <img src="media/md-menu.svg" height="20" width="20">
              </a>
            </div>
            <div class="card collapse" id="menu-list" style="position: absolute;width:200px;right:50px;z-index:100">
              <div class="card card-body p-1">
                <button type="button" class="btn btn-block btn-info" @click="show=''" data-toggle="collapse" href="#menu-list">Home</button>
                <button type="button" class="btn btn-block btn-info" @click="show='explorers'" data-toggle="collapse" href="#menu-list">Explorers</button>
                <button type="button" class="btn btn-block btn-info" @click="show='inventory'" data-toggle="collapse" href="#menu-list">Inventory</button>
                <button type="button" class="btn btn-block btn-info" @click="show='admin'" data-toggle="collapse" href="#menu-list" v-if="isAdmin.length>0">Admin</button>
                <button type="button" class="btn btn-block btn-info" @click="show='about'" data-toggle="collapse" href="#menu-list">About</button>
                <a type="button" class="btn btn-block btn-info mt-3" href="index.html">Astrum Aurum</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--END MENU---------------------------------------------->
      <about v-if="show=='about'"></about>
      <!--ADMIN---------------------------------------------->
      <div class="m-1" align="left" v-if="show=='admin'">
        <ui-eth-admin-gatekeeper v-if="isAdmin.includes('Gatekeeper')"></ui-eth-admin-gatekeeper>
        <ui-eth-admin-storefront v-if="isAdmin.includes('Storefront1155')"></ui-eth-admin-storefront>
        <ui-eth-admin-shards v-if="isAdmin.includes('OutlandsShards')"></ui-eth-admin-shards>
        <ui-eth-admin-treasure v-if="isAdmin.includes('TreasureMinter')"></ui-eth-admin-treasure>
      </div>
      <!--END ADMIN---------------------------------------------->
      <ui-explorers v-if="show=='explorers'" :now="now" :explorers="explorers" :tokens="tokens"></ui-explorers>
      <!--INVENTRORY/STORE---------------------------------------------->
      <div class="m-1" align="center" v-if="show=='inventory'">
        <div class="container my-2" align="right">
          <h3 align="left">Cosmic Staking</h3>
          <span v-if="tokens[0]">CPX: {{tokens[0]}}</span>
          <span v-if="tokens[1]">DMD: {{tokens[1].val.toFixed(5)}}</span>
          <div class="my-2">
            <button class="btn btn-outline-success btn-block" type="button" @click="claimCosmic()" :disabled="!CPXdT.mayClaim">
              <span v-if="!CPXdT.mayClaim">Claim Free Cosmic in {{CPXdT.h}}:{{CPXdT.m}}:{{CPXdT.s}}</span>
              <span v-if="CPXdT.mayClaim">Claim Free Cosmic!</span>
            </button>
          </div>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text">CPX</span>
            </div>
            <input type="number" class="form-control" v-model="stakeAmt">
            <div class="input-group-append">
              <button class="btn btn-outline-success" type="button" @click="stake()" :disabled="stakeAmt>tokens[0]">Stake Cosmic</button>
            </div>
          </div>
          <div v-if="staked[0]>0">Staked: {{staked[0]}} | Available Diamond: {{staked[1].toFixed(5)}}</div>
          <div class="d-flex">
            <div class="input-group w-50">
              <div class="input-group-prepend">
                <span class="input-group-text">CPX</span>
              </div>
              <input type="number" class="form-control" v-model="unstakeAmt">
              <div class="input-group-append">
                <button class="btn btn-outline-success" type="button" @click="unstake()" :disabled="unstakeAmt>staked[0]">Unstake Cosmic</button>
              </div>
            </div>
            <button class="btn btn-outline-success w-50" type="button" @click="claimDiamond()" :disabled="staked[1]==0">Claim Diamond</button>
          </div>
        </div>
        <button class="btn btn-block btn-info w-50" type="button" @click="approveGatekeeper()" v-if="!approval.includes('Gatekeeper')">Approve App to Spend Tokens</button>
        <button class="btn btn-block btn-info w-50" type="button" @click="approveDiamondMinter()" v-if="allowance['DiamondMinter']<100000">Approve Staking</button>
        <div class="container" v-if="approval.includes('Gatekeeper')">
          <h3 align="left">Store</h3>
          <div class="row align-items-center">
            <div class="col">What</div>
            <div class="col">Cost</div>
            <div class="col">Item</div>
            <div class="col"></div>
          </div>
          <div class="row border align-items-center py-1" v-for="(sku,id) in store">
            <div class="col">{{sku.text}}</div>
            <div class="col">{{sku.toPay}}</div>
            <div class="col">{{sku.toBuy}}</div>
            <div class="col" align="right">
              <button class="btn btn-outline-success" type="button" @click="buySKU(id,sku)">Buy</button>
            </div>
          </div>
        </div>
        <div class="mt-2 container" align="left">
          <h3>Inventory</h3>
          <span class="mx-2 p-1 border" v-for="(t,id) in tokens" v-if="!['0','1','1000000'].includes(id)">{{t.name}}: {{t.val}}</span>
        </div>
      </div>
      <!--END INVENTRORY/STORE---------------------------------------------->
      <div class="m-1" align="left" v-if="show==''">
        <div class="m-1 p-1 border" v-for="(Relm,i) in realms">
          <h4>{{Relm.name}}</h4>
          <div class="p-1 region" v-for="(R, key) in regions" v-if="regions && R.realm == i+1">
            <h5>{{R.name}}</h5>
            <div class="p-1 border-top" v-for="S in R.shards">
              <div>{{S.seed}}</div>
              <div>{{S.anchor.text}} [{{S.anchor.rarity}}], Risk/Reward: {{S.anchor.risk[1]}}</div>
            </div>
          </div>
        </div>
      </div>
      <!--FOOTER---------------------------------------------->
      <!--END FOOTER---------------------------------------------->
    </div>
    <!--EXPLORERS---------------------------------------------->
    <template id="ui-explorers">
      <div class="m-1" align="left">
        <h3>Explorers</h3>
        <div class="container">
          <div class="row">
            <div class="col-1">ID</div>
            <div class="col-2">Shard</div>
            <div class="col-2">Cooldown</div>
            <div class="col">Actions</div>
          </div>
          <div v-for="(ex, id) in explorers">
            <div class="row align-items-center">
              <div class="col-1">{{Number(id)-1000000}}</div>
              <div class="col-2">{{ex.shard}}</div>
              <div class="col-2">{{(ex._cool < now) ? 'Ready' : cool(ex._cool)}}</div>
              <div class="col">
                  <div class="input-group">
                    <select class="custom-select" v-model="act">
                      <option v-if="ex.shard==0" value="0">Initialize Location</option>
                      <option v-for="(act,i) in actOpts" :value="i+1">{{act}}</option>
                    </select>
                    <div class="input-group-append">
                      <button class="btn btn-outline-secondary" type="button" @click="exid = id">Act</button>
                    </div>
                  </div>
              </div>
            </div>
            <!--EXPLORER ACTIONS---------------------------------------------->
            <div class="px-3" v-if="exid == id && act > -1">
              <!--EXPLORER MOVE---------------------------------------------->
              <div class="input-group" v-if="act == 1">
                <div class="input-group-prepend">
                  <span class="input-group-text">Shard</span>
                </div>
                <select class="custom-select" v-model="moveTo">
                  <option v-for="s in shards" :value="s.id" v-if="s.id != Number(ex._shard)">{{s.text}}</option>
                </select>
                <div class="input-group-append">
                  <span class="input-group-text" v-if="moveTime>0">{{moveTime}} hours</span>
                  <button class="btn btn-outline-secondary" type="button" @click="move()">Move</button>
                </div>
              </div>
              <!--EXPLORER COOLDOWN---------------------------------------------->
              <div class="input-group" v-if="act == 2">
                <div class="input-group-prepend">
                  <span class="input-group-text">Reduce by</span>
                </div>
                <select class="custom-select" v-model="optsReduceCool.id">
                  <option v-for="c in cooldown" :value="c[0]">{{c[1].name}} [{{c[1].val}}]</option>
                </select>
                <div class="input-group-prepend">
                  <span class="input-group-text">#</span>
                </div>
                <input type="number" class="form-control" v-model="optsReduceCool.qty">
                <div class="input-group-append">
                  <button class="btn btn-outline-secondary" type="button" @click="reduceCool()">Reduce</button>
                </div>
              </div>
            </div>
            <!--END EXPLORER ACTIONS---------------------------------------------->
          </div>
        </div>
      </div>
    </template>
    <!--END EXPLORERS---------------------------------------------->
  </body>
  <script src="lib/d3.min.js"></script>
  <script src="lib/vue.2.5.16.min.js"></script>
  <script src="lib/noty.3.1.4.min.js"></script>
  <script src="lib/popper.1.12.3.min.js"></script>
  <script src="lib/jquery-3.3.1.min.js"></script>
  <script src="lib/bootstrap.min.js"></script>
  <script type="module" src="src/shards/main.js"></script>
</html>
